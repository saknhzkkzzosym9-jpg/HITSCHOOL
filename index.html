<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–§–µ–π–∫–æ–≤–∏–π –ñ—É—Ä–Ω–∞–ª</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #fff; color: #222; transition: transform 0.2s; transform-origin: top left; }
h1 { color: #333; display: inline-block; margin-right: 10px; }
.toolbar { margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
#lockButton { font-size: 20px; cursor: pointer; }
.scale-control { margin-bottom: 10px; }
#journalContainer { overflow-x: auto; }
.month-table { border-collapse: collapse; width: 100%; font-size: 14px; margin-bottom: 20px; transition: transform 0.2s; }
.month-table th, .month-table td { border: 1px solid #ccc; text-align: center; padding: 8px; min-width: 50px; height: 40px; cursor: pointer; }
.month-table td:first-child, .month-table th:first-child { position: sticky; left: 0; background: #f0f0f0; z-index: 2; }
.today { background: #c2f0c2 !important; border: 2px solid #4CAF50; } 
.event-column { background-color: #ADD8E6 !important; }
.cell-popup, .date-popup { position: absolute; background: #fff; border: 1px solid #aaa; padding: 10px; z-index: 100; display: none; box-shadow: 0 2px 8px rgba(0,0,0,0.2); width: 160px; font-size: 13px; }
.cell-popup input[type=number], .date-popup input[type=text] { width: 100%; margin-bottom: 5px; font-size: 14px; }
.cell-popup input[type=text] { font-size: 12px; }
.cell-popup label, .date-popup label { font-size: 12px; display: block; margin-bottom: 3px; }
.cell-popup button, .date-popup button { width: 100%; margin-bottom: 3px; font-size: 12px; }
.event-title { font-size: 11px; margin-top: 2px; display: block; color: #000; }
#studentSearch { margin-bottom:10px; width:300px; padding:5px; }
</style>
</head>
<body>

<h1>–ñ—É—Ä–Ω–∞–ª –∫–ª–∞—Å—É</h1>
<span id="lockButton" onclick="toggleLock()">üîì</span>

<div class="toolbar">
–ö–ª–∞—Å: <select id="classSelect" onchange="checkClass()"></select>
–ü—Ä–µ–¥–º–µ—Ç: <select id="subjectSelect" onchange="buildJournal()"></select>
</div>

<input type="text" id="studentSearch" placeholder="–ü–æ—à—É–∫ —É—á–Ω—è..." oninput="searchStudent()">

<div style="margin-bottom:10px;">
üìå –î/–∑: <input type="text" id="homeworkInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è" style="width:60%;">
<button onclick="saveHomework()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
</div>
<div id="homeworkDisplay" style="margin-bottom:10px; font-weight:bold; color:#d32f2f;">‚ÄºÔ∏è–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è: </div>

<div class="scale-control">
–ú–∞—Å—à—Ç–∞–±: <input type="range" min="50" max="150" value="100" id="zoomRange" oninput="setZoom(this.value)"> %
</div>

<div id="journalContainer"></div>

<div class="cell-popup" id="cellPopup">
<input type="number" id="popupMark" placeholder="–û—Ü—ñ–Ω–∫–∞" min="1" max="12">
<label><input type="checkbox" id="popupAbsent"> –ù (–≤—ñ–¥—Å—É—Ç–Ω—ñ–π)</label>
<label><input type="checkbox" id="popupNoMark"> –ù/–û</label>
<input type="text" id="popupComment" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä">
<button onclick="saveCell()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
<button onclick="closeCellPopup()">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div>

<div class="date-popup" id="datePopup">
<h4>‚ûï –î–æ–¥–∞—Ç–∏ –¥–∞—Ç—É/–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É?</h4>
<label><input type="radio" name="dateEvent" value="–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞"> –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞</label>
<label><input type="radio" name="dateEvent" value="–ü—ñ–¥—Å—É–º–∫–æ–≤–∞"> –ü—ñ–¥—Å—É–º–∫–æ–≤–∞</label>
<label><input type="radio" name="dateEvent" value="–¢–µ–º–∞—Ç–∏—á–Ω–∞"> –¢–µ–º–∞—Ç–∏—á–Ω–∞</label>
<label>–í–∞—à –≤–∞—Ä—ñ–∞–Ω—Ç: <input type="text" id="customEvent"></label>
<button onclick="saveDateEvent()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
<button onclick="closeDatePopup()">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div>

<script>
let journalData = {};
let commentsStore = {};
let dateEvents = {}; 
let homeworkStore = {}; 
let activeCell=null, activeKey=null;
let activeDateHeader=null;
let tableLocked = false;

const students=[
"–ë–æ—Ä–∏—Å –ê–Ω–Ω–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞","–ë–æ—Ä–∏—Å –î—ñ–∞–Ω–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞","–í–∞—á–∫–æ –Ø—Ä–µ–º–∞ –¢–∞—Ä–∞—Å–æ–≤–∏—á","–í–∞—â–∏—à–∏–Ω –í–µ—Ä–æ–Ω—ñ–∫–∞ –Æ—Ä—ñ—ó–≤–Ω–∞",
"–ì–æ–ª—É–± –ú–∞–∫—Å–∏–º –ê–Ω–¥—Ä—ñ–π–æ–≤–∏—á","–ì—Ä–∏–Ω—á—É–∫ –ö–∞—Ç–µ—Ä–∏–Ω–∞ –†–æ–º–∞–Ω—ñ–≤–Ω–∞","–ì—Ä–∏–Ω—è–∫ –î–º–∏—Ç—Ä–æ –í–∞—Å–∏–ª—å–æ–≤–∏—á","–ì—É–¥—å –°–≤—è—Ç–æ—Å–ª–∞–≤ –ü–∞–≤–ª–æ–≤–∏—á",
"–ì—É—Ä—Å—å–∫–∏–π –û—Å—Ç–∞–ø –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á","–ó–∞–±–∏—Ç—ñ–≤—Å—å–∫–∏–π –í º—è—á–µ—Å–ª–∞–≤ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á","–Ü–≤–∞–Ω—á–∏—à–∏–Ω –û–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–Ω–¥—Ä—ñ–π–æ–≤–∏—á",
"–Ü–≤–∞–Ω—é–∫ –†–æ–∫—Å–æ–ª–∞–Ω–∞ –Ü–≥–æ—Ä—ñ–≤–Ω–∞","–ö–∞—Ä–≤–∞—Ü—å–∫–∞ –•—Ä–∏—Å—Ç–∏–Ω–∞ –¢–∞—Ä–∞—Å—ñ–≤–Ω–∞","–ö–Ω–∏—à –ê—Ä—ñ–∞–Ω–∞ –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞","–ö–æ–≤–ª–∏–≥–∞ –ü–∞–≤–ª–æ –†–æ–º–∞–Ω–æ–≤–∏—á",
"–ö–æ–∑–∞—á—É–∫ –î—ñ–∞–Ω–∞ –†–æ–º–∞–Ω—ñ–≤–Ω–∞","–ö–æ—Ä–æ–ª—å—á—É–∫ –î—ñ–∞–Ω–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞","–ö—É–∑—å–º–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –û–ª–µ–≥–æ–≤–∏—á","–ú–∞—Å–∏–∫ –ú–∞–∫—Å–∏–º –Ü–≥–æ—Ä–æ–≤–∏—á",
"–ú—É–∑–∏–∫–∞ –Æ—Å—Ç–∏–Ω–∞ –û–ª–µ–≥—ñ–≤–Ω–∞","–û–∫—Ä–µ–ø–∫–∏–π –û—Å—Ç–∞–ø –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á","–û–Ω–∏—Å—å–∫–æ –ú–∞—Ä—Ç–∞ –û–ª–µ—Å—ñ–≤–Ω–∞","–ü—Ä–æ–∫–æ–ø–µ—á–∫–æ –†–æ–º–∞–Ω –¢–∞—Ä–∞—Å–æ–≤–∏—á",
"–†–µ–∑–µ–∫—É–ª–æ–≤ –í–æ–ª–æ–¥–∏–º–∏—Ä –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á","–†—É–¥–∏–∫ –î–æ–º—ñ–Ω—ñ–∫–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞","–°–∞–ª–∞–º–∞—Ö–∞ –ú–∞—Ä–∫–æ –ù–∞–∑–∞—Ä—ñ–π–æ–≤–∏—á","–°–º–æ–ª–∞ –°–≤—è—Ç–æ—Å–ª–∞–≤ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á",
"–°–ø—ñ–Ω—É–ª –í–µ—Ä–æ–Ω—ñ–∫–∞ –Æ—Ä—ñ—ó–≤–Ω–∞","–°—É—Ö–∞–Ω–æ–≤–∞ –ö–∞—Ä—ñ–Ω–∞ –Æ—Ä—ñ—ó–≤–Ω–∞","–®–µ–≤—á–µ–Ω–∫–æ –î–º–∏—Ç—Ä–æ –Ñ–≤–≥–µ–Ω–æ–≤–∏—á","–®–ø—ñ–∫ –û–ª–µ–≥ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á"];

const subjects=[
"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞","–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞","–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞","–ê–ª–≥–µ–±—Ä–∞","–ì–µ–æ–º–µ—Ç—Ä—ñ—è",
"–Ü—Å—Ç–æ—Ä—ñ—è –£–∫—Ä–∞—ó–Ω–∏","–í—Å–µ—Å–≤—ñ—Ç–Ω—è —ñ—Å—Ç–æ—Ä—ñ—è","–ë—ñ–æ–ª–æ–≥—ñ—è","–ì–µ–æ–≥—Ä–∞—Ñ—ñ—è","–§—ñ–∑–∏–∫–∞","–•—ñ–º—ñ—è",
"–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞","–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ –º–æ–≤–∞","–ù—ñ–º–µ—Ü—å–∫–∞ –º–æ–≤–∞","–§—Ä–∞–Ω—Ü—É–∑—å–∫–∞ –º–æ–≤–∞","–§—ñ–∑–∫—É–ª—å—Ç—É—Ä–∞",
"–¢—Ä—É–¥–æ–≤–µ –Ω–∞–≤—á–∞–Ω–Ω—è","–ú—É–∑–∏—á–Ω–µ –º–∏—Å—Ç–µ—Ü—Ç–≤–æ","–û–±—Ä–∞–∑–æ—Ç–≤–æ—Ä—á–µ –º–∏—Å—Ç–µ—Ü—Ç–≤–æ","–ó–∞—Ä—É–±—ñ–∂–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞",
"–ü—Ä–∞–≤–æ–∑–Ω–∞–≤—Å—Ç–≤–æ","–ì—Ä–æ–º–∞–¥—è–Ω—Å—å–∫–∞ –æ—Å–≤—ñ—Ç–∞","–ï—Ç–∏–∫–∞","–Ø –¥–æ—Å–ª—ñ–¥–∂—É—é —Å–≤—ñ—Ç"];

const classSelect = document.getElementById("classSelect");
const subjectSelect = document.getElementById("subjectSelect");
const journalContainer = document.getElementById("journalContainer");
const cellPopup = document.getElementById("cellPopup");
const datePopup = document.getElementById("datePopup");
const popupMark = document.getElementById("popupMark");
const popupAbsent = document.getElementById("popupAbsent");
const popupNoMark = document.getElementById("popupNoMark");
const popupComment = document.getElementById("popupComment");
const customEvent = document.getElementById("customEvent");

// –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ —ñ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤
["6-–ê","6-–ë","6-–í","6-–ì","7-–ê","7-–ë","7-–í","7-–ì","8-–ê","8-–ë","8-–í","8-–ì","9-–ê","9-–ë","9-–í","9-–ì","10-–ê","10-–ë","10-–í","10-–ì","11-–ê","11-–ë","11-–í","11-–ì"].forEach(c=>{let opt=document.createElement("option"); opt.textContent=c; classSelect.appendChild(opt);});
subjects.forEach(s=>{ let opt=document.createElement("option"); opt.textContent=s; subjectSelect.appendChild(opt); });

const today = new Date();

// --- –ú–∞—Å—à—Ç–∞–± ---
function setZoom(value){ document.body.style.transform = `scale(${value/100})`; }

// --- –ü–æ—à—É–∫ —É—á–Ω—ñ–≤ ---
function searchStudent(){
  const filter = document.getElementById("studentSearch").value.toLowerCase();
  document.querySelectorAll(".month-table tbody tr").forEach(tr=>{
    const name = tr.cells[0].textContent.toLowerCase();
    tr.style.display = name.includes(filter)? "" : "none";
  });
}

// --- –ó–∞–º–æ–∫ ---
function toggleLock(){
  tableLocked = !tableLocked;
  document.getElementById("lockButton").textContent = tableLocked ? "üîí" : "üîì";
}

// --- –î/–∑ ---
function saveHomework(){
  const key = classSelect.value + "_" + subjectSelect.value;
  homeworkStore[key] = document.getElementById("homeworkInput").value;
  displayHomework();
}
function displayHomework(){
  const key = classSelect.value + "_" + subjectSelect.value;
  const hwText = homeworkStore[key] || "";
  document.getElementById("homeworkDisplay").textContent = "‚ÄºÔ∏è–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è: " + hwText;
}

// --- –ü–æ–±—É–¥–æ–≤–∞ –∂—É—Ä–Ω–∞–ª—É ---
function buildJournal(){
  const cls = classSelect.value;
  const subj = subjectSelect.value;
  const key = cls+"_"+subj;
  if(!journalData[key]) journalData[key]={};

  journalContainer.innerHTML="";
  const daysInMonth = 31;
  const table = document.createElement("table"); table.className="month-table"; journalContainer.appendChild(table);
  const thead = document.createElement("thead"); table.appendChild(thead);
  const tbody = document.createElement("tbody"); table.appendChild(tbody);

  const headRow = document.createElement("tr");
  const thName = document.createElement("th"); thName.textContent="–£—á–Ω—ñ"; headRow.appendChild(thName);

  for(let d=1; d<=daysInMonth; d++){
    const th = document.createElement("th"); th.innerHTML=d+"<span class='event-title'></span>";
    const cellDate = new Date(today.getFullYear(), today.getMonth(), d);
    if(cellDate.toDateString()===today.toDateString()) th.classList.add("today");
    th.onclick=(e)=>openDatePopup(e,d);
    headRow.appendChild(th);
  }
  const thAvg = document.createElement("th"); thAvg.textContent="–°–µ—Ä–µ–¥–Ω—ñ–π"; headRow.appendChild(thAvg);
  thead.appendChild(headRow);

  students.forEach((name,i)=>{
    const tr = document.createElement("tr");
    const tdName = document.createElement("td"); tdName.textContent=(i+1)+". "+name; tr.appendChild(tdName);
    let total=0,count=0;
    for(let d=1; d<=daysInMonth; d++){
      const td = document.createElement("td");
      const dateKey = today.getFullYear()+"-"+("0"+(today.getMonth()+1)).slice(-2)+"-"+("0"+d).slice(-2);
      td.dataset.date=dateKey; td.dataset.student=i;
      td.onclick=(e)=>{ if(!tableLocked) cellClick(e,td,key); };
      if(journalData[key][dateKey+"_"+i]){
        td.innerHTML = journalData[key][dateKey+"_"+i];
        td.style.backgroundColor = getColorFromText(journalData[key][dateKey+"_"+i]);
        let num = parseInt(journalData[key][dateKey+"_"+i]);
        if(!isNaN(num)){ total+=num; count++; }
      }
      tr.appendChild(td);
    }
    const tdAvg = document.createElement("td"); tdAvg.textContent = count>0? (total/count).toFixed(1) : ""; tr.appendChild(tdAvg);
    tbody.appendChild(tr);
  });

  // –ü–æ–¥—ñ—ó
  for(let d=1; d<=daysInMonth; d++){
    const dateStr = today.getFullYear()+"-"+("0"+(today.getMonth()+1)).slice(-2)+"-"+("0"+d).slice(-2);
    const eventName = dateEvents[dateStr];
    if(eventName){
      const th = table.querySelector("thead tr").cells[d];
      th.querySelector(".event-title").textContent = eventName;
      for(let r=0;r<students.length;r++){
        table.querySelectorAll("tbody tr")[r].cells[d].classList.add("event-column");
      }
    }
  }

  displayHomework();
}

// --- –ö–æ–ª—å–æ—Ä–∏ –æ—Ü—ñ–Ω–æ–∫ ---
function getColorFromText(text){
  if(text.includes("–ù")) return "#ff4d4d";
  if(text.includes("–ù/–û")) return "#cccccc";
  let num = parseInt(text);
  if(num>=1 && num<=3) return "#ff4d4d";
  if(num>=4 && num<=6) return "#ffeb3b";
  if(num>=7 && num<=11) return "#b6ff4d";
  return "";
}

// --- –†–æ–±–æ—Ç–∞ –∑ –∫–ª—ñ—Ç–∏–Ω–∫–∞–º–∏ ---
function cellClick(e, cell, key){
  activeCell=cell; activeKey=key;
  const rect = cell.getBoundingClientRect();
  cellPopup.style.top = (rect.bottom + window.scrollY) + "px";
  cellPopup.style.left = (rect.left + window.scrollX) + "px";
  cellPopup.style.display = "block";
  const storageKey = cell.dataset.date+"_"+cell.dataset.student;
  let val = journalData[key][storageKey] || "";
  popupMark.value = val.match(/\d+/)? val.match(/\d+/)[0] : "";
  popupAbsent.checked = val.includes("–ù") && !val.includes("–ù/–û");
  popupNoMark.checked = val.includes("–ù/–û");
  popupComment.value = commentsStore[key]?.[storageKey] || "";
  popupMark.focus();
}
function saveCell(){
  let val="";
  if(popupAbsent.checked) val="–ù";
  else if(popupNoMark.checked) val="–ù/–û";
  else if(popupMark.value) val=popupMark.value;
  if(popupComment.value) val+=" üí≠";
  activeCell.innerHTML = val;
  activeCell.style.backgroundColor = getColorFromText(val);
  const storageKey = activeCell.dataset.date+"_"+activeCell.dataset.student;
  journalData[activeKey][storageKey]=val;
  if(popupComment.value){ if(!commentsStore[activeKey]) commentsStore[activeKey]={}; commentsStore[activeKey][storageKey]=popupComment.value; }
  closeCellPopup();
}
function closeCellPopup(){ cellPopup.style.display="none"; }

// --- –ü–æ–¥—ñ—ó ---
function openDatePopup(e, day){
  activeDateHeader = e.target;
  const rect = e.target.getBoundingClientRect();
  datePopup.style.top = (rect.bottom + window.scrollY) + "px";
  datePopup.style.left = (rect.left + window.scrollX) + "px";
  datePopup.style.display = "block";
}
function saveDateEvent(){
  let val = document.querySelector('input[name="dateEvent"]:checked')?.value || customEvent.value;
  if(val && activeDateHeader){
    const d = activeDateHeader.textContent.trim().split("\n")[0];
    const dateStr = today.getFullYear()+"-"+("0"+(today.getMonth()+1)).slice(-2)+"-"+("0"+d).slice(-2);
    dateEvents[dateStr]=val;
    buildJournal();
    closeDatePopup();
  }
}
function closeDatePopup(){ datePopup.style.display="none"; customEvent.value=""; document.querySelectorAll('input[name="dateEvent"]').forEach(r=>r.checked=false); }

// --- –°—Ç–∞—Ä—Ç ---
window.onload=()=>{ 
  classSelect.value="6-–ê"; 
  subjectSelect.value="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"; 
  buildJournal(); 
};
</script>

</body>
</html>